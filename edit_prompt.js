const fs = require('fs');
const path = require('path');
const filePath = path.join('backend', 'services', 'openaiService.js');
const text = fs.readFileSync(filePath, 'utf8');
const startMarker = '    const prompt = You are an expert in recruitment and professional CV optimization.\n';
const endMarker = '    // Configure model and max_tokens for a very detailed CV\n';
const startIdx = text.indexOf(startMarker);
if (startIdx === -1) {
  throw new Error('start marker not found');
}
const endIdx = text.indexOf(endMarker, startIdx);
if (endIdx === -1) {
  throw new Error('end marker not found');
}
const newBlock =     const prompt = \You are an expert in recruitment and professional CV optimization.\n\nORIGINAL CV TO OPTIMIZE:\n\\n\nTARGET JOB DESCRIPTION:\n\\n\nTASK: Create a COMPLETE, PROFESSIONAL, ONE-PAGE CV optimized for this position while preserving all sections listed below.\nThe final text must span roughly 350-450 words so it can fit on a single page, and every mandatory section (especially Education and Technical Skills) must remain even when condensed.\n\n============================================================\nEXACT FORMAT TO FOLLOW (STRICT STRUCTURE):\n============================================================\n\n[FULL NAME IN UPPERCASE]\n[Target Job Title]\n\nCONTACT\n[Phone] | [Email] | [Address] | [LinkedIn/Portfolio]\n\nPROFESSIONAL PROFILE\n[A 5-7 line paragraph describing: years of experience, main areas of expertise, key skills, major achievements with PRECISE NUMBERS (%, $, volume), value for the employer, and career goals aligned with the role.]\n\nPROFESSIONAL EXPERIENCE\n\n[Job Title] | [Company Name], [City, Country]\n[Month Year] - [Month Year or Present]\n- [Achievement 1 with strong action verb + context + quantified result]\n- [Achievement 2 with strong action verb + context + quantified result]\n- [Achievement 3 with strong action verb + context + quantified result]\n- [Achievement 4 with strong action verb + context + quantified result]\n(Limit each role to up to 4 bullets and focus on the 3-4 most relevant positions to keep the CV to one page.)\n\nKEY PROJECTS\n[Project Name 1]\n[Detailed description of project, context, and objectives] | [Dates]\n- Technologies: [Complete list of technologies used, keep concise]\n- Results: [Results with NUMBERS: performance, adoption, savings, etc.]\n- Impact: [Measurable impact on the organization or users]\n(Include 1-2 key projects if space allows; prioritize alignment with the job.)\n\nEDUCATION\n\n[Full Degree with specialization]\n[Institution Name] | [City, Country]\n[Start Year] - [End Year]\n- Specialization: [Specific field]\n- Honors: [Honors if applicable]\n- Academic Projects: [Projects relevant to the role]\n(Keep this section clear but brief enough to preserve the one-page limit.)\n\nTECHNICAL SKILLS\n\n- Programming Languages: [Complete and prioritized list of all languages, condensed to what matters most]\n- Frameworks & Libraries: [Complete list: frameworks, libraries, development tools]\n- Databases: [Complete list: SQL, NoSQL, management tools]\n- Cloud & DevOps: [Cloud platforms, CI/CD tools, containerization, orchestration]\n- Tools & Technologies: [IDE, version control, collaboration, design tools, etc.]\n- Methodologies: [Agile, Scrum, Kanban, TDD, etc.]\n- Soft Skills: [Communication, leadership, problem solving, etc.]\n(Do not omit this section; summarize thoughtfully to save space.)\n\nLANGUAGES\n\n- [Language 1]: [Precise level - Native/Bilingual/Fluent/Intermediate/Basic] - [Certification if applicable]\n- [Language 2]: [Precise level] - [Certification if applicable]\n- [Language 3]: [Precise level] - [Certification if applicable]\n\nCERTIFICATIONS\n\n- [Certification 1] - [Issuing organization], [Month Year]\n- [Certification 2] - [Issuing organization], [Month Year]\n\n============================================================\nABSOLUTE RULES (MUST FOLLOW):\n============================================================\n\nREQUIRED:\n1. Start DIRECTLY with the NAME (NO text before it).\n2. Follow EXACTLY the format above (sections in this order), including Contact, Professional Profile, Professional Experience, Key Projects, Education, Technical Skills, Languages, and Certifications.\n3. Maximum 4 bullet points per professional experience entry; do not exceed or invent extra bullets.\n4. Keep the CV to roughly 350-450 words to ensure it fits a single page.\n5. Maintain the mandatory sections (especially Education and Technical Skills) even while tightening content.\n6. EVERY bullet MUST contain a NUMBER or METRIC (%, $, count, time).\n7. Use strong action verbs in past tense: Developed, Designed, Optimized, Increased, Reduced, Managed, Led, Created, Implemented, Improved.\n8. Integrate KEYWORDS from the job description throughout the CV.\n9. Expand EACH experience with CONCRETE and SPECIFIC details.\n10. Add rich CONTEXT: team size, budget, technologies, challenges.\n11. Quantify EVERYTHING: volumes, percentages, time, savings, growth.\n12. Create a professional profile of at least 5-7 lines (not 2-3 lines).\n\nSTRICTLY FORBIDDEN:\n1. No explanatory comments ('This optimized CV...', 'Here is...', 'I created...').\n2. No notes, conclusions, or remarks outside the CV itself.\n3. No empty sections.\n4. No generic bullet points without metrics ('Worked on projects').\n5. No text before the name.\n6. No unexplained abbreviations.\n\nNOW GENERATE THE COMPLETE CV STRICTLY FOLLOWING THIS FORMAT:
